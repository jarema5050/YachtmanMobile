{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import*as Crypto from'expo-crypto';import*as Random from'expo-random';import invariant from'invariant';var CHARSET='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';function getRandomValuesAsync(input){var output,bytes,i;return _regeneratorRuntime.async(function getRandomValuesAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:output=input;if(input.byteLength!==input.length)input=new Uint8Array(input.buffer);_context.next=4;return _regeneratorRuntime.awrap(Random.getRandomBytesAsync(input.length));case 4:bytes=_context.sent;for(i=0;i<bytes.length;i++){input[i]=bytes[i];}return _context.abrupt(\"return\",output);case 7:case\"end\":return _context.stop();}}},null,null,null,Promise);}function convertBufferToString(buffer){var state=[];for(var i=0;i<buffer.byteLength;i+=1){var index=buffer[i]%CHARSET.length;state.push(CHARSET[index]);}return state.join('');}function convertToUrlSafeString(b64){return b64.replace(/\\+/g,'-').replace(/\\//g,'_').replace(/=/g,'');}export function generateRandomAsync(size){var buffer;return _regeneratorRuntime.async(function generateRandomAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:buffer=new Uint8Array(size);_context2.next=3;return _regeneratorRuntime.awrap(getRandomValuesAsync(buffer));case 3:return _context2.abrupt(\"return\",convertBufferToString(buffer));case 4:case\"end\":return _context2.stop();}}},null,null,null,Promise);}export function deriveChallengeAsync(code){var buffer;return _regeneratorRuntime.async(function deriveChallengeAsync$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:invariant(code.length>42&&code.length<129,'Invalid code length for PKCE.');_context3.next=3;return _regeneratorRuntime.awrap(Crypto.digestStringAsync(Crypto.CryptoDigestAlgorithm.SHA256,code,{encoding:Crypto.CryptoEncoding.BASE64}));case 3:buffer=_context3.sent;return _context3.abrupt(\"return\",convertToUrlSafeString(buffer));case 5:case\"end\":return _context3.stop();}}},null,null,null,Promise);}export function buildCodeAsync(){var size,codeVerifier,codeChallenge,_args4=arguments;return _regeneratorRuntime.async(function buildCodeAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:size=_args4.length>0&&_args4[0]!==undefined?_args4[0]:128;_context4.next=3;return _regeneratorRuntime.awrap(generateRandomAsync(size));case 3:codeVerifier=_context4.sent;_context4.next=6;return _regeneratorRuntime.awrap(deriveChallengeAsync(codeVerifier));case 6:codeChallenge=_context4.sent;return _context4.abrupt(\"return\",{codeVerifier:codeVerifier,codeChallenge:codeChallenge});case 8:case\"end\":return _context4.stop();}}},null,null,null,Promise);}export function generateHexStringAsync(size){var value,buffer;return _regeneratorRuntime.async(function generateHexStringAsync$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _regeneratorRuntime.awrap(generateRandomAsync(size));case 2:value=_context5.sent;_context5.next=5;return _regeneratorRuntime.awrap(Crypto.digestStringAsync(Crypto.CryptoDigestAlgorithm.SHA256,value,{encoding:Crypto.CryptoEncoding.HEX}));case 5:buffer=_context5.sent;return _context5.abrupt(\"return\",convertToUrlSafeString(buffer));case 7:case\"end\":return _context5.stop();}}},null,null,null,Promise);}","map":{"version":3,"sources":["../src/PKCE.ts"],"names":[],"mappings":"4DAAA,MAAO,GAAK,CAAA,MAAZ,KAAwB,aAAxB,CACA,MAAO,GAAK,CAAA,MAAZ,KAAwB,aAAxB,CACA,MAAO,CAAA,SAAP,KAAsB,WAAtB,CAEA,GAAM,CAAA,OAAO,CAAG,gEAAhB,CAEA,QAAe,CAAA,oBAAf,CAAoC,KAApC,mJACQ,MADR,CACiB,KADjB,CAGE,GAAI,KAAK,CAAC,UAAN,GAAqB,KAAK,CAAC,MAA/B,CAAuC,KAAK,CAAG,GAAI,CAAA,UAAJ,CAAe,KAAK,CAAC,MAArB,CAAR,CAHzC,iDAKsB,MAAM,CAAC,mBAAP,CAA2B,KAAK,CAAC,MAAjC,CALtB,SAKQ,KALR,eAOE,IAAS,CAAT,CAAa,CAAb,CAAgB,CAAC,CAAG,KAAK,CAAC,MAA1B,CAAkC,CAAC,EAAnC,EAAuC,KAAK,CAAC,CAAD,CAAL,CAAW,KAAK,CAAC,CAAD,CAAhB,CAAvC,CAPF,gCASS,MATT,uEAYA,QAAS,CAAA,qBAAT,CAA+B,MAA/B,CAAiD,CAC/C,GAAM,CAAA,KAAK,CAAa,EAAxB,CACA,IAAK,GAAI,CAAA,CAAC,CAAG,CAAb,CAAgB,CAAC,CAAG,MAAM,CAAC,UAA3B,CAAuC,CAAC,EAAI,CAA5C,CAA+C,CAC7C,GAAM,CAAA,KAAK,CAAG,MAAM,CAAC,CAAD,CAAN,CAAY,OAAO,CAAC,MAAlC,CACA,KAAK,CAAC,IAAN,CAAW,OAAO,CAAC,KAAD,CAAlB,EACD,CACD,MAAO,CAAA,KAAK,CAAC,IAAN,CAAW,EAAX,CAAP,CACD,CAED,QAAS,CAAA,sBAAT,CAAgC,GAAhC,CAA2C,CACzC,MAAO,CAAA,GAAG,CACP,OADI,CACI,KADJ,CACW,GADX,EAEJ,OAFI,CAEI,KAFJ,CAEW,GAFX,EAGJ,OAHI,CAGI,IAHJ,CAGU,EAHV,CAAP,CAID,CAED,MAAO,SAAe,CAAA,mBAAf,CAAmC,IAAnC,6IACC,MADD,CACU,GAAI,CAAA,UAAJ,CAAe,IAAf,CADV,mDAGC,oBAAoB,CAAC,MAAD,CAHrB,0CAIE,qBAAqB,CAAC,MAAD,CAJvB,wEAWP,MAAO,SAAe,CAAA,oBAAf,CAAoC,IAApC,8IAEL,SAAS,CAAC,IAAI,CAAC,MAAL,CAAc,EAAd,EAAoB,IAAI,CAAC,MAAL,CAAc,GAAnC,CAAwC,+BAAxC,CAAT,CAFK,kDAIgB,MAAM,CAAC,iBAAP,CAAyB,MAAM,CAAC,qBAAP,CAA6B,MAAtD,CAA8D,IAA9D,CAAoE,CACvF,QAAQ,CAAE,MAAM,CAAC,cAAP,CAAsB,MADuD,CAApE,CAJhB,SAIC,MAJD,iDAOE,sBAAsB,CAAC,MAAD,CAPxB,wEAUP,MAAO,SAAe,CAAA,cAAf,mLACL,IADK,kDACU,GADV,mDAIsB,mBAAmB,CAAC,IAAD,CAJzC,SAIC,YAJD,kEAKuB,oBAAoB,CAAC,YAAD,CAL3C,SAKC,aALD,iDAOE,CAAE,YAAY,CAAZ,YAAF,CAAgB,aAAa,CAAb,aAAhB,CAPF,wEAaP,MAAO,SAAe,CAAA,sBAAf,CAAsC,IAAtC,wMACe,mBAAmB,CAAC,IAAD,CADlC,SACC,KADD,kEAEgB,MAAM,CAAC,iBAAP,CAAyB,MAAM,CAAC,qBAAP,CAA6B,MAAtD,CAA8D,KAA9D,CAAqE,CACxF,QAAQ,CAAE,MAAM,CAAC,cAAP,CAAsB,GADwD,CAArE,CAFhB,SAEC,MAFD,iDAKE,sBAAsB,CAAC,MAAD,CALxB","sourcesContent":["import * as Crypto from 'expo-crypto';\nimport * as Random from 'expo-random';\nimport invariant from 'invariant';\n\nconst CHARSET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\nasync function getRandomValuesAsync(input: Uint8Array): Promise<Uint8Array> {\n  const output = input;\n  // Get access to the underlying raw bytes\n  if (input.byteLength !== input.length) input = new Uint8Array(input.buffer);\n\n  const bytes = await Random.getRandomBytesAsync(input.length);\n\n  for (let i = 0; i < bytes.length; i++) input[i] = bytes[i];\n\n  return output;\n}\n\nfunction convertBufferToString(buffer: Uint8Array): string {\n  const state: string[] = [];\n  for (let i = 0; i < buffer.byteLength; i += 1) {\n    const index = buffer[i] % CHARSET.length;\n    state.push(CHARSET[index]);\n  }\n  return state.join('');\n}\n\nfunction convertToUrlSafeString(b64: string): string {\n  return b64\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=/g, '');\n}\n\nexport async function generateRandomAsync(size: number): Promise<string> {\n  const buffer = new Uint8Array(size);\n  // TODO(Bacon): Change this to be sync in the future when Expo unimodules support sync methods\n  await getRandomValuesAsync(buffer);\n  return convertBufferToString(buffer);\n}\n\n/**\n * Proof key for Code Exchange by OAuth Public Clients (RFC 7636), Section 4.1\n * [Section 4.1](https://tools.ietf.org/html/rfc7636#section-4.1)\n */\nexport async function deriveChallengeAsync(code: string): Promise<string> {\n  // 43 is the minimum, and 128 is the maximum.\n  invariant(code.length > 42 && code.length < 129, 'Invalid code length for PKCE.');\n\n  const buffer = await Crypto.digestStringAsync(Crypto.CryptoDigestAlgorithm.SHA256, code, {\n    encoding: Crypto.CryptoEncoding.BASE64,\n  });\n  return convertToUrlSafeString(buffer);\n}\n\nexport async function buildCodeAsync(\n  size: number = 128\n): Promise<{ codeChallenge: string; codeVerifier: string }> {\n  // This method needs to be resolved like all other native methods.\n  const codeVerifier = await generateRandomAsync(size);\n  const codeChallenge = await deriveChallengeAsync(codeVerifier);\n\n  return { codeVerifier, codeChallenge };\n}\n\n/**\n * Digest a random string with hex encoding, useful for creating `nonce`s.\n */\nexport async function generateHexStringAsync(size: number): Promise<string> {\n  const value = await generateRandomAsync(size);\n  const buffer = await Crypto.digestStringAsync(Crypto.CryptoDigestAlgorithm.SHA256, value, {\n    encoding: Crypto.CryptoEncoding.HEX,\n  });\n  return convertToUrlSafeString(buffer);\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}