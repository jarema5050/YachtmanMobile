{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import*as React from'react';import NavigationStateContext from\"./NavigationStateContext\";export default function useOptionsGetters(_ref){var key=_ref.key,getOptions=_ref.getOptions,getState=_ref.getState;var _React$useState=React.useState(0),_React$useState2=_slicedToArray(_React$useState,2),numberOfChildrenListeners=_React$useState2[0],setNumberOfChildrenListeners=_React$useState2[1];var optionsGettersFromChild=React.useRef({});var _React$useContext=React.useContext(NavigationStateContext),parentAddOptionsGetter=_React$useContext.addOptionsGetter;var getOptionsFromListener=React.useCallback(function(){for(var _key in optionsGettersFromChild.current){if(optionsGettersFromChild.current.hasOwnProperty(_key)){var _optionsGettersFromCh,_optionsGettersFromCh2;var result=(_optionsGettersFromCh=(_optionsGettersFromCh2=optionsGettersFromChild.current)[_key])===null||_optionsGettersFromCh===void 0?void 0:_optionsGettersFromCh.call(_optionsGettersFromCh2);if(result!==null){return result;}}}return null;},[]);var getCurrentOptions=React.useCallback(function(){var _getOptions;if(getState){var state=getState();if(state.routes[state.index].key!==key){return null;}}var optionsFromListener=getOptionsFromListener();if(optionsFromListener!==null){return optionsFromListener;}return(_getOptions=getOptions===null||getOptions===void 0?void 0:getOptions())!==null&&_getOptions!==void 0?_getOptions:undefined;},[getState,getOptionsFromListener,getOptions,key]);React.useEffect(function(){return parentAddOptionsGetter===null||parentAddOptionsGetter===void 0?void 0:parentAddOptionsGetter(key,getCurrentOptions);},[getCurrentOptions,parentAddOptionsGetter,key]);var addOptionsGetter=React.useCallback(function(key,getter){optionsGettersFromChild.current[key]=getter;setNumberOfChildrenListeners(function(prev){return prev+1;});return function(){setNumberOfChildrenListeners(function(prev){return prev-1;});delete optionsGettersFromChild.current[key];};},[]);var hasAnyChildListener=React.useMemo(function(){return numberOfChildrenListeners>0;},[numberOfChildrenListeners]);return{addOptionsGetter:addOptionsGetter,getCurrentOptions:getCurrentOptions,hasAnyChildListener:hasAnyChildListener};}","map":{"version":3,"sources":["useOptionsGetters.tsx"],"names":["getState","React","optionsGettersFromChild","addOptionsGetter","parentAddOptionsGetter","getOptionsFromListener","result","getCurrentOptions","state","optionsFromListener","getOptions","setNumberOfChildrenListeners","prev","hasAnyChildListener","numberOfChildrenListeners"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport NavigationStateContext from './NavigationStateContext';\nimport type { NavigationState } from '@react-navigation/routers';\n\nexport default function useOptionsGetters({\n  key,\n  getOptions,\n  getState,\n}: {\n  key?: string;\n  getOptions?: () => object | undefined;\n  getState?: () => NavigationState;\n}) {\n  let [\n    numberOfChildrenListeners,\n    setNumberOfChildrenListeners,\n  ] = React.useState(0);\n  const optionsGettersFromChild = React.useRef<\n    Record<string, () => object | undefined | null>\n  >({});\n\n  const { addOptionsGetter: parentAddOptionsGetter } = React.useContext(\n    NavigationStateContext\n  );\n\n  const getOptionsFromListener = React.useCallback(() => {\n    for (let key in optionsGettersFromChild.current) {\n      if (optionsGettersFromChild.current.hasOwnProperty(key)) {\n        const result = optionsGettersFromChild.current[key]?.();\n        // null means unfocused route\n        if (result !== null) {\n          return result;\n        }\n      }\n    }\n    return null;\n  }, []);\n\n  const getCurrentOptions = React.useCallback(() => {\n    if (getState) {\n      const state = getState();\n      if (state.routes[state.index].key !== key) {\n        // null means unfocused route\n        return null;\n      }\n    }\n\n    const optionsFromListener = getOptionsFromListener();\n    if (optionsFromListener !== null) {\n      return optionsFromListener;\n    }\n    return getOptions?.() ?? undefined;\n  }, [getState, getOptionsFromListener, getOptions, key]);\n\n  React.useEffect(() => {\n    return parentAddOptionsGetter?.(key!, getCurrentOptions);\n  }, [getCurrentOptions, parentAddOptionsGetter, key]);\n\n  const addOptionsGetter = React.useCallback(\n    (key: string, getter: () => object | undefined | null) => {\n      optionsGettersFromChild.current[key] = getter;\n      setNumberOfChildrenListeners((prev) => prev + 1);\n\n      return () => {\n        setNumberOfChildrenListeners((prev) => prev - 1);\n        // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n        delete optionsGettersFromChild.current[key];\n      };\n    },\n    []\n  );\n\n  const hasAnyChildListener = React.useMemo(\n    () => numberOfChildrenListeners > 0,\n    [numberOfChildrenListeners]\n  );\n\n  return {\n    addOptionsGetter,\n    getCurrentOptions,\n    hasAnyChildListener,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}