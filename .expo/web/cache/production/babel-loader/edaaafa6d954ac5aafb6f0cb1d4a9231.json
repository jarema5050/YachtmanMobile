{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import*as AuthSession from\"expo-auth-session\";import jwtDecode from\"jwt-decode\";import React,{useState}from\"react\";import Alert from\"react-native-web/dist/exports/Alert\";import Platform from\"react-native-web/dist/exports/Platform\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import{Button}from'react-native-elements';import AsyncStorage from'@react-native-community/async-storage';import auth0 from\"../services/Auth0\";var credentialsModule=require(\"./AuthCredentials\");var webAuth=auth0.webAuth;var auth0ClientId=credentialsModule.auth0ClientId;var authorizationEndpoint=credentialsModule.domain+\"/authorize\";var useProxy=Platform.select({web:false,default:true});var redirectUri=AuthSession.makeRedirectUri({useProxy:useProxy});export default function Authentication(_ref){var buttonParams=_ref.buttonParams,task=_ref.task;var _React$useState=React.useState(null),_React$useState2=_slicedToArray(_React$useState,2),name=_React$useState2[0],setName=_React$useState2[1];var _AuthSession$useAuthR=AuthSession.useAuthRequest({redirectUri:redirectUri,clientId:auth0ClientId,responseType:\"token\",scopes:[\"openid\",\"profile\",\"email\"],extraParams:{nonce:\"nonce\"}},{authorizationEndpoint:authorizationEndpoint}),_AuthSession$useAuthR2=_slicedToArray(_AuthSession$useAuthR,3),request=_AuthSession$useAuthR2[0],result=_AuthSession$useAuthR2[1],promptAsync=_AuthSession$useAuthR2[2];console.log(\"Redirect URL: \"+redirectUri);var storeUserData=function storeUserData(value){var jsonValue;return _regeneratorRuntime.async(function storeUserData$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;jsonValue=JSON.stringify(value);_context.next=4;return _regeneratorRuntime.awrap(AsyncStorage.setItem('@user_data',jsonValue));case 4:_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);console.log(\"Storing encoded data failed -\"+_context.t0.message);case 9:case\"end\":return _context.stop();}}},null,null,[[0,6]],Promise);};var storeToken=function storeToken(value){var jsonValue;return _regeneratorRuntime.async(function storeToken$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;jsonValue=JSON.stringify(value);_context2.next=4;return _regeneratorRuntime.awrap(AsyncStorage.setItem('@auth_token',jsonValue));case 4:_context2.next=9;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);console.log(\"Storing JWT token failed -\"+_context2.t0.message);case 9:case\"end\":return _context2.stop();}}},null,null,[[0,6]],Promise);};var fetchUserData=function fetchUserData(authToken){var userData;return _regeneratorRuntime.async(function fetchUserData$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(webAuth.client.userInfo({token:authToken},function(err){console.log(\"userInfo \"+err.message);}));case 2:userData=_context3.sent;if(userData!=null){console.log(userData);storeUserData(userData);setName(userData.givenName);task();}case 4:case\"end\":return _context3.stop();}}},null,null,null,Promise);};React.useEffect(function(){if(result){console.log(result);if(result.error){Alert.alert(\"Authentication error\",result.params.error_description||\"something went wrong\");return;}if(result.type===\"success\"){var authToken=result.params.access_token;storeToken(authToken);fetchUserData(authToken);}}},[result]);return React.createElement(View,null,name?React.createElement(Text,{style:styles.containerBottom},\"You are logged in, \",name,\"!\"):React.createElement(Button,{disabled:!request,buttonStyle:buttonParams.styleBtnBody,titleStyle:buttonParams.styleBtnTitle,title:buttonParams.titleTxt,onPress:function onPress(){return promptAsync({useProxy:useProxy});}}));}var styles=StyleSheet.create({container:{flex:1,backgroundColor:\"#fff\",alignItems:\"center\",justifyContent:\"center\"},title:{fontSize:20,textAlign:\"center\",marginTop:40}});","map":{"version":3,"sources":["/Users/sokolowski/Documents/Private Repositories/YachtmanMobile/services/Authentication.js"],"names":["AuthSession","jwtDecode","React","useState","Button","AsyncStorage","auth0","credentialsModule","require","webAuth","auth0ClientId","authorizationEndpoint","domain","useProxy","Platform","select","web","default","redirectUri","makeRedirectUri","Authentication","buttonParams","task","name","setName","useAuthRequest","clientId","responseType","scopes","extraParams","nonce","request","result","promptAsync","console","log","storeUserData","value","jsonValue","JSON","stringify","setItem","message","storeToken","fetchUserData","authToken","client","userInfo","token","err","userData","givenName","useEffect","error","Alert","alert","params","error_description","type","access_token","styles","containerBottom","styleBtnBody","styleBtnTitle","titleTxt","StyleSheet","create","container","flex","backgroundColor","alignItems","justifyContent","title","fontSize","textAlign","marginTop"],"mappings":"6HAAA,MAAO,GAAKA,CAAAA,WAAZ,KAA6B,mBAA7B,CACA,MAAOC,CAAAA,SAAP,KAAsB,YAAtB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,C,+RAEA,OAASC,MAAT,KAAuB,uBAAvB,CACA,MAAOC,CAAAA,YAAP,KAAyB,uCAAzB,CACA,MAAOC,CAAAA,KAAP,yBAQA,GAAMC,CAAAA,iBAAiB,CAAGC,OAAO,qBAAjC,CACA,GAAMC,CAAAA,OAAO,CAAGH,KAAK,CAACG,OAAtB,CACA,GAAMC,CAAAA,aAAa,CAAGH,iBAAiB,CAACG,aAAxC,CACA,GAAMC,CAAAA,qBAAqB,CAAGJ,iBAAiB,CAACK,MAAlB,CAA2B,YAAzD,CAEA,GAAMC,CAAAA,QAAQ,CAAGC,QAAQ,CAACC,MAAT,CAAgB,CAAEC,GAAG,CAAE,KAAP,CAAcC,OAAO,CAAE,IAAvB,CAAhB,CAAjB,CACA,GAAMC,CAAAA,WAAW,CAAGlB,WAAW,CAACmB,eAAZ,CAA4B,CAAEN,QAAQ,CAARA,QAAF,CAA5B,CAApB,CAEA,cAAe,SAASO,CAAAA,cAAT,MAA8C,IAArBC,CAAAA,YAAqB,MAArBA,YAAqB,CAAPC,IAAO,MAAPA,IAAO,qBACnCpB,KAAK,CAACC,QAAN,CAAe,IAAf,CADmC,oDACpDoB,IADoD,qBAC9CC,OAD8C,+CAGpBxB,WAAW,CAACyB,cAAZ,CACrC,CACEP,WAAW,CAAXA,WADF,CAEEQ,QAAQ,CAAEhB,aAFZ,CAIEiB,YAAY,CAAE,OAJhB,CAMEC,MAAM,CAAE,CAAC,QAAD,CAAW,SAAX,CAAsB,OAAtB,CANV,CAOEC,WAAW,CAAE,CAEXC,KAAK,CAAE,OAFI,CAPf,CADqC,CAarC,CAAEnB,qBAAqB,CAArBA,qBAAF,CAbqC,CAHoB,gEAGpDoB,OAHoD,2BAG3CC,MAH2C,2BAGnCC,WAHmC,2BAqB3DC,OAAO,CAACC,GAAR,kBAA6BjB,WAA7B,EAEA,GAAMkB,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAOC,KAAP,uJAEZC,SAFY,CAEAC,IAAI,CAACC,SAAL,CAAeH,KAAf,CAFA,kDAGZhC,YAAY,CAACoC,OAAb,CAAqB,YAArB,CAAmCH,SAAnC,CAHY,uFAKlBJ,OAAO,CAACC,GAAR,CAAY,gCAAgC,YAAEO,OAA9C,EALkB,wEAAtB,CAQA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAAON,KAAP,wJAETC,SAFS,CAEGC,IAAI,CAACC,SAAL,CAAeH,KAAf,CAFH,mDAGThC,YAAY,CAACoC,OAAb,CAAqB,aAArB,CAAoCH,SAApC,CAHS,2FAKfJ,OAAO,CAACC,GAAR,CAAY,6BAA6B,aAAEO,OAA3C,EALe,yEAAnB,CAQA,GAAME,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAOC,SAAP,2LACGpC,OAAO,CAACqC,MAAR,CAAeC,QAAf,CAAwB,CAACC,KAAK,CAACH,SAAP,CAAxB,CAA2C,SAASI,GAAT,CAAc,CAC9Ef,OAAO,CAACC,GAAR,CAAY,YAAcc,GAAG,CAACP,OAA9B,EACD,CAFsB,CADH,SACdQ,QADc,gBAIpB,GAAIA,QAAQ,EAAI,IAAhB,CAAqB,CACnBhB,OAAO,CAACC,GAAR,CAAYe,QAAZ,EACAd,aAAa,CAACc,QAAD,CAAb,CACA1B,OAAO,CAAC0B,QAAQ,CAACC,SAAV,CAAP,CACA7B,IAAI,GACL,CATmB,sEAAtB,CAWApB,KAAK,CAACkD,SAAN,CAAgB,UAAM,CACpB,GAAIpB,MAAJ,CAAY,CACVE,OAAO,CAACC,GAAR,CAAYH,MAAZ,EACA,GAAIA,MAAM,CAACqB,KAAX,CAAkB,CAChBC,KAAK,CAACC,KAAN,CACE,sBADF,CAEEvB,MAAM,CAACwB,MAAP,CAAcC,iBAAd,EAAmC,sBAFrC,EAIA,OACD,CACD,GAAIzB,MAAM,CAAC0B,IAAP,GAAgB,SAApB,CAA+B,CAC7B,GAAMb,CAAAA,SAAS,CAAGb,MAAM,CAACwB,MAAP,CAAcG,YAAhC,CACAhB,UAAU,CAACE,SAAD,CAAV,CACAD,aAAa,CAACC,SAAD,CAAb,CACD,CACF,CACF,CAhBD,CAgBG,CAACb,MAAD,CAhBH,EAkBA,MACE,qBAAC,IAAD,MACGT,IAAI,CACH,oBAAC,IAAD,EAAM,KAAK,CAAEqC,MAAM,CAACC,eAApB,wBAAyDtC,IAAzD,KADG,CAGH,oBAAC,MAAD,EACE,QAAQ,CAAE,CAACQ,OADb,CAEE,WAAW,CAAGV,YAAY,CAACyC,YAF7B,CAGE,UAAU,CAAIzC,YAAY,CAAC0C,aAH7B,CAIE,KAAK,CAAG1C,YAAY,CAAC2C,QAJvB,CAKE,OAAO,CAAE,yBAAM/B,CAAAA,WAAW,CAAC,CAAEpB,QAAQ,CAARA,QAAF,CAAD,CAAjB,EALX,EAJJ,CADF,CAeD,CAED,GAAM+C,CAAAA,MAAM,CAAGK,UAAU,CAACC,MAAX,CAAkB,CAC/BC,SAAS,CAAE,CACTC,IAAI,CAAE,CADG,CAETC,eAAe,CAAE,MAFR,CAGTC,UAAU,CAAE,QAHH,CAITC,cAAc,CAAE,QAJP,CADoB,CAO/BC,KAAK,CAAE,CACLC,QAAQ,CAAE,EADL,CAELC,SAAS,CAAE,QAFN,CAGLC,SAAS,CAAE,EAHN,CAPwB,CAAlB,CAAf","sourcesContent":["import * as AuthSession from \"expo-auth-session\";\nimport jwtDecode from \"jwt-decode\";\nimport React, { useState } from \"react\";\nimport { Alert, Platform, StyleSheet, Text, View } from \"react-native\";\nimport { Button } from 'react-native-elements';\nimport AsyncStorage from '@react-native-community/async-storage';\nimport auth0 from '../services/Auth0'\n// You need to swap out the Auth0 client id and domain with the one from your Auth0 client.\n// In your Auth0 client, you need to also add a url to your authorized redirect urls.\n//\n// For this application, I added https://auth.expo.io/@arielweinberger/with-auth0 because I am\n// signed in as the \"arielweinberger\" account on Expo and the name/slug for this app is \"with-auth0\".\n//\n// You can open this app in the Expo client and check your logs to find out your redirect URL.\nconst credentialsModule = require('./AuthCredentials');\nconst webAuth = auth0.webAuth;\nconst auth0ClientId = credentialsModule.auth0ClientId;\nconst authorizationEndpoint = credentialsModule.domain + \"/authorize\";\n\nconst useProxy = Platform.select({ web: false, default: true });\nconst redirectUri = AuthSession.makeRedirectUri({ useProxy });\n\nexport default function Authentication({buttonParams, task}) {\n  const [name, setName] = React.useState(null);\n\n  const [request, result, promptAsync] = AuthSession.useAuthRequest(\n    {\n      redirectUri,\n      clientId: auth0ClientId,\n      // id_token will return a JWT token\n      responseType: \"token\",\n      // retrieve the user's profile\n      scopes: [\"openid\", \"profile\", \"email\"],\n      extraParams: {\n        // ideally, this will be a random value\n        nonce: \"nonce\",\n      },\n    },\n    { authorizationEndpoint }\n  );\n\n  // Retrieve the redirect URL, add this to the callback URL list\n  // of your Auth0 application.\n  console.log(`Redirect URL: ${redirectUri}`);\n\n  const storeUserData = async (value) => {\n    try {\n      const jsonValue = JSON.stringify(value)\n      await AsyncStorage.setItem('@user_data', jsonValue)\n    } catch (e) {\n      console.log(\"Storing encoded data failed -\"+e.message)\n    }\n  }\n  const storeToken = async (value) => {\n    try {\n      const jsonValue = JSON.stringify(value)\n      await AsyncStorage.setItem('@auth_token', jsonValue)\n    } catch (e) {\n      console.log(\"Storing JWT token failed -\"+e.message)\n    }\n  }\n  const fetchUserData = async (authToken) => {\n    const userData = await webAuth.client.userInfo({token:authToken}, function(err) {\n      console.log(\"userInfo \" + err.message)\n    });\n    if (userData != null){\n      console.log(userData)\n      storeUserData(userData)\n      setName(userData.givenName)\n      task()\n    }  \n  } \n  React.useEffect(() => {\n    if (result) {\n      console.log(result)\n      if (result.error) {\n        Alert.alert(\n          \"Authentication error\",\n          result.params.error_description || \"something went wrong\"\n        );\n        return;\n      }\n      if (result.type === \"success\") {\n        const authToken = result.params.access_token\n        storeToken(authToken)\n        fetchUserData(authToken)\n      }\n    }\n  }, [result]);\n\n  return (\n    <View>\n      {name ? (\n        <Text style={styles.containerBottom}>You are logged in, {name}!</Text>\n      ) : (\n        <Button\n          disabled={!request}\n          buttonStyle ={buttonParams.styleBtnBody}\n          titleStyle = {buttonParams.styleBtnTitle}\n          title= {buttonParams.titleTxt}\n          onPress={() => promptAsync({ useProxy })}\n        />\n      )}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: \"#fff\",\n    alignItems: \"center\",\n    justifyContent: \"center\",\n  },\n  title: {\n    fontSize: 20,\n    textAlign: \"center\",\n    marginTop: 40,\n  },\n});"]},"metadata":{},"sourceType":"module"}